
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>customer_form</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <!--link Bootstrap Framework-->
    <link rel="stylesheet" href="assests/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles/pos_styles.css">
    <link href="icons/css/all.min.css" rel="stylesheet">


</head>
<body>

<header>
    <!--  Defined nav links -->
    <nav class="navbar navbar-expand-lg bg-primary navColor">
        <div class="container-fluid">
            <a class="navbar-brand text-white fw-bold" href="index.html">
                <img src="assests/images/logo.jpg" alt="Logo" width="40" height="40"
                     class="d-inline-block align-text-center">
                POS-SYSTEM
            </a>
            <button aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation"
                    class="navbar-toggler"
                    data-bs-target="#navbarNavDropdown" data-bs-toggle="collapse" type="button">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul id="ul-list" class="navbar-nav  me-auto mb-2 mb-lg-0 text-white">
                    <li class="nav-item fs-5 ">
                        <a aria-current="page" class="nav-link text-white" href="index.html" id="linkHome">Home</a>
                    </li>
                    <li class="nav-item fs-5">
                        <a class="nav-link text-white table-hover " href="customer_form.html"
                           id="linkCustomer">Customers</a>
                    </li>
                    <li class="nav-item fs-5">
                        <a class="nav-link text-white" href="item_form.html" id="linkItem">Items</a>
                    </li>
                    <li class="nav-item fs-5">
                        <a class="nav-link text-white" href="place-order_form.html" id="linkOrder">Orders</a>
                    </li>
                    <li class="nav-item fs-5">
                        <a class="nav-link text-white" href="order_details_form.html" id="linkPurchaseOrder">Order-Details</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

</header>

<!-- ==================== Customer Manage Content Start =====================-->

<section class="container-fluid mt-3" id="customerContent">

    <!-- ****** Section of Customer Details Form ****** -->

    <!-- Title of the Customer Form -->
    <section class="container-fluid mt-1">
        <div style="height: 10px; text-align: center">
            <h2 id="heading_h2" class="bg-secondary border border-2 border-secondary text-light"
                style="border-radius: 25px; font-family: 'poppins', sans-serif"> M A N A G E - C U S T O M E R S </h2>
        </div>
    </section>

    <!-- customer related data form -->
    <section class="container-fluid mt-5">

        <form id="customerForm">
            <!-- Define First Row-->
            <div class="row">
                <div class="mb-3 col">
                    <label class="form-label" for="txtCusId">Customer ID</label>
                    <input class="form-control customer_form" id="txtCusId" placeholder="C00-001" name="id" type="text">
                    <p><small class="text-danger pl-1" id="lblCusId"></small></p>
                </div>
                <div class="mb-3 col">
                    <label class="form-label" for="txtCusName">Customer Name</label>
                    <input class="form-control customer_form" id="txtCusName" placeholder="Ishara Maduranga" name="name"
                           type="text">
                    <p><small class="text-danger pl-1" id="lblCusName"></small></p>
                </div>
            </div>

            <!-- Define Second Row-->
            <div class="row">

                <div class="mb-3 col">
                    <label class="form-label" for="txtCusAddress">Customer Address</label>
                    <input class="form-control customer_form" id="txtCusAddress"
                           placeholder="NO : C/195 Waharaka Ruwanwella" name="address" type="text">
                    <p><small class="text-danger pl-1" id="lblCusAddress"></small></p>
                </div>

                <div class="mb-3 col">
                    <label class="form-label" for="txtCusSalary">Customer Salary</label>
                    <input class="form-control customer_form" id="txtCusSalary" placeholder="65000.00" name="salary"
                           type="number">
                    <p><small class="text-danger pl-1" id="lblCusContact"></small></p>
                </div>
            </div>
        </form>
    </section>

    <!-- Section of Button Group -->
    <section class="container-fluid mt-1 button ">
        <button class="btn btn-primary" id="btnCustomerSave" type="button">Add Customer</button>
        <button class="btn btn-warning " id="btnGetAllCustomer" type="button">Get All Customer</button>
        <button class="btn btn-success" id="btnUpdateCustomer">Update Customer</button>
        <button class="btn btn-danger" id="btnDeleteCustomer">Delete Customer</button>
        <button class="btn btn-info" id="btnClear">Clear</button>

    </section>

    <!-- Section of Search Bar -->
    <section class="container-fluid mt-3">
        <form class="d-flex">
            <input aria-label="Search" typeof="text" class="form-control me-2" id="txtSearchCustomer"
                   placeholder="Search Customer..."
                   type="search">
            <button class="btn btn-outline-success  border border-success border-2 " id="btnSearchCustomer"
                    type="button" style="width: 150px">Search
            </button>
        </form>
    </section>

    <!-- Section of Customer Table -->
    <section class="row mt-3">

        <div class="col" style="height: 297px; overflow-x: scroll">
            <table class="table table-bordered table-hover ">
                <thead class="bg-secondary text-white" id="tableHead">
                <tr class="head">
                    <th scope="col">Customer ID</th>
                    <th scope="col">Customer Name</th>
                    <th scope="col">Customer Address</th>
                    <th scope="col">Customer Salary</th>
                </tr>
                </thead>
                <tbody id="customerTable" class="table-light">


                </tbody>
            </table>
        </div>
    </section>

</section>

<!--Import js for bootstrap-->
<script src="assests/js/bootstrap.min.js"></script>
<script src="assests/jquery/jquery-3.6.1.min.js"></script>

<script>
    let baseURL="http://localhost:8080/pos/";
    loadAllCustomers();

    function saveCustomer() {
        //send ajax request to the customer Servlet

        let formData = $("#customerForm").serialize();

        $.ajax({
            url:baseURL+"customer",
            method:"post",
            data:formData,
            dataType: "json",
            success:function (resp) {
                alert(resp.message);
                loadAllCustomers();

            },
            error:function (error) {

                let JsnErrObj = JSON.parse(error.responseText);
                alert(JsnErrObj.message);
            }
        });
    }
    
    $("#btnCustomerSave").click(function () {
        saveCustomer();
    });

    $("#btnGetAllCustomer").click(function () {
        loadAllCustomers();
        clearTextFields()
    });

    $("#btnDeleteCustomer").click(function () {
        let cusID = $('#txtCusId').val();
        $.ajax({
            url:baseURL+"customer?id="+cusID,
            method: "delete",
            dataType:"json",
            success:function (resp) {
                alert(resp.message)
                loadAllCustomers();
            },
            error:function (error) {
                alert(JSON.parse(error.responseText).message);
            }
        });
    });

    $("#btnUpdateCustomer").click(function () {

        let customerID = $('#txtCusId').val();
        let customerName = $('#txtCusName').val();
        let customerAddress = $('#txtCusAddress').val();
        let customerSalary = $('#txtCusSalary').val();

      var customer={
          id:customerID,
          name:customerName,
          address:customerAddress,
          salary:customerSalary
      }
        $.ajax({
            url:baseURL+"customer",
            method:"put",
            contentType: "application/json",
            data: JSON.stringify(customer),
            dataType:"json",
            success:function (resp) {
                alert(resp.message);
                loadAllCustomers();
            },
            error:function (error) {
                alert(JSON.parse(error.responseText).message);
            }
        });
    });

    $("#btnClear").click(function () {
        clearTextFields()
    });

   function loadAllCustomers(){
       $("#customerTable").empty()
       $.ajax({
           url: baseURL+"customer",
           dataType:"json",
           success:function (resp){
               for (let cus of resp.data) {
                   $("#customerTable") .append("<tr> <td>"+cus.id+"</td> <td>"+cus.name+"</td> <td>"+cus.address+"</td> <td>"+cus.salary+"</td> </tr>")
               }
               setData_Bind_Row_Events();
               clearTextFields();
               $("#txtCusId").focus();
           }
       });
    }


    /** BIND ROW CLICK EVENT FUNCTION ... */
    function setData_Bind_Row_Events() {
        $('#customerTable>tr').click(function () {
            let id = $(this).children(":eq(0)").text();
            let name = $(this).children(":eq(1)").text();
            let address = $(this).children(":eq(2)").text();
            let salary = $(this).children(":eq(3)").text();

            /** setting table details values to text fields */
            $('#txtCusId').val(id);
            $('#txtCusName').val(name);
            $('#txtCusAddress').val(address);
            $('#txtCusSalary').val(salary);
        });
        /** Remove Selected Row when double clicked */
        $("#customerTable>tr").on('dblclick', function () {
            $(this).remove();
        });
    }

    function clearTextFields() {
        $('#txtCusId').val("");
        $('#txtCusName').val("");
        $('#txtCusAddress').val("");
        $('#txtCusSalary').val("");
    }

    /** Text Fields Key down to focus functionalities... */
    $("#txtCusId,#txtCusName,#txtCusAddress,#txtCusSalary").on('keydown', function (event) {
        if (event.key == "Tab") {
            event.preventDefault();
        }
    });

    $("#txtCusId").on('keydown', function (event) {

        if (event.key == "Enter") {
            $("#txtCusName").focus();
        }
    });

    $("#txtCusName").on('keydown', function (event) {
        if (event.key == "Enter") {
            $("#txtCusAddress").focus();
        }
    });

    $("#txtCusAddress").on('keydown', function (event) {
        if (event.key == "Enter") {
            $("#txtCusSalary").focus();
        }
    });

    $("#txtCusSalary").on('keydown', function (event) {
        if (event.key == "Enter") {

            let option = confirm("Do you  Want To Save Customer ?");

            if (option) {
                saveCustomer();
            }

            $("#txtCusId").focus();
        }
    });
    
    
</script>

</body>
</html>